# 用来处理和输出模型训练中间数据

import csv


def process_data(input_file, output_file):
    data = []

    with open(input_file, 'r') as file:
        lines = file.readlines()
        epoch_num = 1

        for i in range(0, len(lines) - 1):
            epoch_number = epoch_num
            train_loss = float(lines[i].split(":")[2].split(",")[0].strip())
            valid_loss = float(lines[i].split(":")[3].split(",")[0].strip())
            accuracy = float(lines[i].split(":")[4].split(",")[0].strip())
            precision = float(lines[i].split(":")[5].split(",")[0].strip())
            recall = float(lines[i].split(":")[6].split(",")[0].strip())
            f1 = float(lines[i].split(":")[7].split(",")[0].strip())

            data.append([epoch_number, train_loss, valid_loss, accuracy, precision, recall, f1])
            epoch_num += 1

    with open(output_file, 'w', newline='') as csvfile:
        csvwriter = csv.writer(csvfile)
        csvwriter.writerow(['Epoch', 'Train Loss', 'valid loss', 'accuracy', 'precision', 'recall', 'f1'])
        csvwriter.writerows(data)


if __name__ == "__main__":
    input_file_path = "api_pretrain_finetune.txt"  # 替换为实际文件路径
    output_file_path = "api_pretrain_finetune_model_performance.csv"  # 替换为输出文件名

    process_data(input_file_path, output_file_path)
